<!DOCTYPE html>
<html class="nojs" lang="en-GB" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Inverse Problem Ã— Diffusion -- Part: A â€“ Mem.Capsule ðŸ’Š</title>
<meta name="view-transition" content="same-origin">
<meta name="description" content=" &amp;amp;ldquo;An inverse problem seeks to recover an unknown signal from a set of observed measurements. Specifically, suppose $x\in R^n$ is an unknown signal, and $y\in R^m = â€¦">
<meta name="created" content="2022-12-19T00:00:00+0000">
<meta name="modified" content="2022-12-19T00:00:00+0000">

<meta name="contact" content="TimberH2000@outlook.com">
<meta property="og:site_name" content="Mem.Capsule ðŸ’Š">
<meta property="og:title" content="Inverse Problem Ã— Diffusion -- Part: A">
<meta property="og:url" content="https://yuhaoo00.github.io/posts/snapshots/2212diffusionforinversea/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://yuhaoo00.github.io/favicon-192.png">
<meta name="generator" content="Hugo 0.118.2">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#ffffff">


<link rel="canonical" href="https://yuhaoo00.github.io/posts/snapshots/2212diffusionforinversea/">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">

<link rel="stylesheet" href="/css/mobile.928a90a2e5ceccad718844ea67aa6bba151ff555ab514fb103071cc7b60c2ff2.css" media="screen">
<link rel="stylesheet" href="/css/styles.4de5736f3d2ae947b3a627fc44a38d245e8529684e89c7c75098ce5f52375440.css">
<link rel="stylesheet" href="/css/print.31e2819287afc91406f2fd43d21a8ba4a0cdfc272e439c90db0c6e47efc7c346.css" media="print">

<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "WebPage",
    "headline": "Inverse Problem Ã— Diffusion -- Part: A",
    "datePublished": "2022-12-19T00:00:00Z",
    "dateModified": "2022-12-19T00:00:00Z",
    "url" : "https://yuhaoo00.github.io/posts/snapshots/2212diffusionforinversea/",
    "description": " \u0026amp;ldquo;An inverse problem seeks to recover an unknown signal from a set of observed measurements. Specifically, suppose $x\\in R^n$ is an unknown signal, and $y\\in R^m = â€¦",
    "keywords": ["Diffusion","ScoreModel","ImageGeneration","ControlledGeneration","InverseProblem"],
    "image" : "https://yuhaoo00.github.io/favicon-192.png",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://yuhaoo00.github.io"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Mem.Capsule ðŸ’Š",
      "logo" : {
        "@type": "ImageObject",
        "url": "https://yuhaoo00.github.io/favicon-192.png"
      },
      "url": "https://yuhaoo00.github.io"
    }
  }
</script>

<script src="/js/script-early.214cc4b0248ef64425811a906c0c6a3702edffba5dbc127128e9ff989c74c137.js"></script>

<script defer src="/js/mobile.2ee7f57bec29e942a94fc13cd4cf128b0b8daf996652b9725d7e9bf960496721.js"></script>
<script defer src="/js/script.1688e04483adf683d47143ac70e770c7b5e4b75213641f33b46d9b84cb3e91ca.js"></script>

<link rel="stylesheet" href="/katex/katex.min.css">
<script defer src="/katex/katex.min.js"></script>
<script defer src="/katex/contrib/auto-render.min.js"></script>
<script defer src="/js/math.f08366f847be855a2a8edced48e6cbaca080c199dfc2efd172b4788a2f58d85e.js"></script>



</head>

<body class="single-page">
<div class="page layout__page">
<header class="header layout__header">
<h1 class="header__site-name">
<a href="/" title="Home" class="header__site-link" rel="home"><span>Mem.Capsule ðŸ’Š</span></a>
</h1>
<div class="region header__region">
</div>
<div class="mobile-nav" dir="ltr">
  <div class="mobile-nav__cover"></div>
  <button class="mobile-nav__toggle button--outline" aria-expanded="false" aria-controls="sheet">
    Menu
    <svg class="mobile-nav__hamburger" viewBox="0 0 100 100" focusable="false" aria-hidden="true">
      <rect width="80" height="12" x="10" y="20" rx="5"></rect>
      <rect width="80" height="12" x="10" y="45" rx="5"></rect>
      <rect width="80" height="12" x="10" y="70" rx="5"></rect>
    </svg>
  </button>
  <div class="mobile-nav__sheet link-inverted link-nav" id="sheet" aria-hidden="true">
    <div class="mobile-nav__region"></div>
    <nav class="mobile-nav__main-menu" aria-label="Main menu">
    <ul class="mobile-nav__navbar">
    <li><a href="/">Home</a></li>
    <li><a href="/contact/">Contact</a></li>
    <li><a href="/search/">Search</a></li>
    <li><a href="/posts/" aria-current="page">Posts</a></li>
    </ul>
    </nav>
  </div>
</div>
</header>

<nav class="main-menu layout__navigation" aria-label="Main menu">
<ul class="navbar">
<li><a href="/">Home</a></li>
<li><a href="/contact/">Contact</a></li>
<li><a href="/search/">Search</a></li>
<li><a href="/posts/" aria-current="page">Posts</a></li>
</ul>
</nav>
<main class="main layout__main">
<article class="single-view single-view--posts">
<header>
<h1 class="title mb--xxs">Inverse Problem Ã— Diffusion -- Part: A</h1>
<div class="submitted meta">
<time class="created-date" datetime="2022-12-19T00:00:00Z">19 December, 2022</time>

</div>
<div class="tags meta">
Tags:
<ul>
<li><a href="https://yuhaoo00.github.io/tags/diffusion/">Diffusion</a></li>
<li><a href="https://yuhaoo00.github.io/tags/scoremodel/">ScoreModel</a></li>
<li><a href="https://yuhaoo00.github.io/tags/imagegeneration/">ImageGeneration</a></li>
<li><a href="https://yuhaoo00.github.io/tags/controlledgeneration/">ControlledGeneration</a></li>
<li><a href="https://yuhaoo00.github.io/tags/inverseproblem/">InverseProblem</a></li>
</ul>
</div>
</header>

<blockquote>
<p>&ldquo;An inverse problem seeks to recover an unknown signal from a set of observed measurements. Specifically, suppose $x\in R^n$ is an unknown signal, and $y\in R^m = Ax+z$ is a noisy observation given by m linear measurements, where the measurement acquisition process is represented by a linear operator $A\in R^{m\times n}$, and $z\in R^n$ represents a noise vector. Solving a linear inverse problem amounts to recovering the signal $x$ from its measurement $y$. Without further assumptions, the problem is ill-defined when $m&lt; n$, so we additionally assume that $x$ is sampled from a prior distribution $p(x)$&rdquo;</p>
<p><strong>source from <a href="http://arxiv.org/abs/2111.08005">Dr. Yang Song&rsquo;s paper</a></strong></p>
</blockquote>
<p>As unconditional generative model, Diffusion models (or Score models) can play a prior term in optimization for various ill-posed image inverse problems. Such methods are often labeled as training-free, zero-shot, unsupervised, etc.</p>
<p>On the other hand, Diffusion models also can be trained as conditional one $s_\theta(x_t,y,t)$, where $y$ is the condition from other mode. However, this will consume a lot of resources both in the computing power and the collection of paired data $\lbrace x_i,y_i\rbrace$.</p>
<h2 id="medical-score-sde" class="icon-inline" id="medical-score-sde">Medical Score-SDE<a class="icon-link" href="#medical-score-sde" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg></a></h2>
<p><a href="http://arxiv.org/abs/2111.08005">-&gt; Yang Song, et al. in ICLR, 2022.</a></p>
<figure class="image">
<img src="https://image-1300968464.cos.ap-shanghai.myqcloud.com/Obsidian/20231017172654.png" loading="lazy">
<figcaption>
The medical imaging problem (source from paper)</figcaption>
</figure>

<h3 id="step1-perturbing-measurements" class="icon-inline" id="step1-perturbing-measurements">step1: Perturbing measurements<a class="icon-link" href="#step1-perturbing-measurements" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg></a></h3>
<p>Since $x_t=\alpha(t)x_0+\beta(t)z$, and we set $y_t=Ax_t+\alpha(t)\epsilon$, so we have $y_t=\alpha(t)y+\beta(t)Az$.</p>
<blockquote>
<p>Smart and reasonable assumption for the coefficient $+\alpha(t)\epsilon$ to avoid the subsequent diffusion of random measurement noise $\epsilon$.</p>
</blockquote>
<h3 id="step2-generation-with-score-sde" class="icon-inline" id="step2-generation-with-score-sde">step2: Generation with Score-SDE<a class="icon-link" href="#step2-generation-with-score-sde" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg></a></h3>
<p>Using the Euler-Maruyama sampler, the generative process given by:</p>
<p>$$
x_{t-\Delta t} = x_t-f(t)x_t\Delta t+g(t)^2s_\theta(x_t,t)\Delta t+g(t)\sqrt{\Delta t}z
$$</p>
<p>where $s_\theta(\cdot)$ is the trained score model, $\Delta t = 1/N$ is the set discrete time, and $z\sim \mathcal{N}(0,1)$.</p>
<h3 id="step3-consistent-guidance" class="icon-inline" id="step3-consistent-guidance">step3: Consistent Guidance<a class="icon-link" href="#step3-consistent-guidance" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg></a></h3>
<p><figure class="image">
<img src="https://image-1300968464.cos.ap-shanghai.myqcloud.com/Obsidian/20231017164345.png" loading="lazy">
<figcaption>
The pipeline of medical Score-SDE</figcaption>
</figure>

We set the guided intermediate result as $x_t^{\prime}$, For simultaneously minimizing the distance between $x_t$ and $x_t^{\prime}$, and the distance between $x_t^{\prime}$ and the hyperplane $\lbrace x\in R^n| Ax=y_t \rbrace$, we build an  optimization problem as:</p>
<p>$$
\begin{aligned}
x_t^{\prime}&amp;=\arg \min_{v\in R^n}\lbrace (1-\lambda)\Vert v-x_t \Vert_{T}^2 + \min_{u\in R^n} \lambda \Vert v-u \Vert_{T}^2 \rbrace \
s.t.\quad Au&amp;=y_t
\end{aligned}
$$</p>
<p>which has the closed-form solution as:</p>
<p>$$
x_t^{\prime}=T^{-1}[\lambda \Lambda \mathcal{P} ^{-1}(\Lambda)y_t+(1-\lambda)\Lambda Tx_t+(1-\Lambda)Tx_t]
$$</p>
<p>When the measurement process is noisy, we can choose $0&lt;\lambda&lt;1$ to allow slackness in $Ax_t^{\prime}=y_t$ (more affected by $p(x)$). When the measurement process contains no noise, the authors chosse $\lambda=1$ at the last sampling step to guarantee $Ax_0^{\prime}=y$.</p>
<h2 id="score-mri" class="icon-inline" id="score-mri">Score-MRI<a class="icon-link" href="#score-mri" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg></a></h2>
<p><a href="https://www.sciencedirect.com/science/article/pii/S1361841522001268">-&gt; Hyungjin Chung, et al.  Medical Image Analysis, 2022.</a></p>
<p>Similar to the above, Score-MRI inserts a more simple consistency mapping after every &ldquo;Predictor&rdquo; and &ldquo;Corrector&rdquo; iteration.</p>
<p>$$
x_i=x_i+\lambda A^\ast(y-Ax_i)=(I-\lambda A^\ast A)x_i+A^\ast y
$$</p>
<p>where $A^\ast$ denotes the Hermitian adjoint, and $+\lambda A^\ast (y-Ax_i)$ can be viewed as a rectification for minimizing the distance between $y$ and $Ax_i$. In the hybridtype Algorithm 5 (complex domain and multi-coils for MRI), the authors start with $\lambda = 1.0$ in the first iteration, and linearly decrease the value to $\lambda=0.2$ at the last iteration.</p>
<blockquote>
<p><a href="http://arxiv.org/abs/1706.00051">GANCS</a> has an similar rectification $(I-\Phi^{â€ }\Phi)x+\Phi^{â€ }y$, where pseudo-inverse $\Phi^{â€ }$ satisfies $\Phi\Phi^{â€ }\Phi=\Phi$, but without the scaling factor $\lambda$.  In this paper, the authors view $(I-\Phi^{â€ }\Phi)x$ as a projection onto the <a href="https://dx.doi.org/10.1088/1361-6420/aaf14a">nullspace</a> of $\Phi$.</p>
</blockquote>
<figure class="image">
<img src="https://image-1300968464.cos.ap-shanghai.myqcloud.com/Obsidian/20231017182641.png" loading="lazy" width="500">
</figure>

<h2 id="ddnm" class="icon-inline" id="ddnm">DDNM<a class="icon-link" href="#ddnm" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg></a></h2>
<p><a href="http://arxiv.org/abs/2212.00490">-&gt; Yinhuai Wang, et al. in ICLR, 2023.</a></p>
<h3 id="noise-free" class="icon-inline" id="noise-free">Noise-free<a class="icon-link" href="#noise-free" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg></a></h3>
<p>Similar to <a href="http://arxiv.org/abs/1706.00051">GANCS</a>, DDNM adopts a rectified estimation as:</p>
<p>$$
x_{0|t}^{\prime}=A^{â€ }y+(I-A^{â€ }A)x_{0|t}
$$</p>
<p>where $x_{0|t}$ is the predicted version at timestep $t$. Based on <a href="http://arxiv.org/abs/2010.02502">DDIM</a>, the generative process can be driven by $x_{t-1}\sim \mathcal{p}(x_{t-1}|x_t,x_{0|t}^{\prime})$. So it might provide a more reliable rectification to human-perceptible $x_{0|t}$, rather than noisy $x_t$ like in <a href="http://arxiv.org/abs/2010.02502">Score-MRI</a>.</p>
<blockquote>
<p>Although this paper mentioned that this consistency mapping was inspired by <strong>range-null space decomposition</strong> $x=A^{â€ }Ax+(I-A^{â€ }A)x$, but it seems to contradict with the subsequent DDNM+ for the noisy inverse problem.</p>
</blockquote>
<h3 id="noisy" class="icon-inline" id="noisy">Noisy<a class="icon-link" href="#noisy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg></a></h3>
<p>$$
x_{0|t}^{\prime}=A^â€ y+(Iâˆ’A^â€ A)x_{0|t} =x_{0|t}-A^â€ (Ax_{0|t}-y)
$$</p>
<p>In short, the authors employ two scale factors $\Sigma_t$ &amp; $\Phi_t$ into range-space correction &amp; generative variance, respectively.</p>
<p>$$
\begin{aligned}
x_{0|t}^{\prime}&amp;= x_{0|t}-\Sigma_tA^â€ (Ax_{0|t}-y)\\
p^{\prime}(x_{t-1}|x_t,x_{0|t}^{\prime})&amp;=\mathcal{N}(x_{t-1};\mu_t(x_t, x_{0|t}^{\prime}),\Phi_t I)
\end{aligned}
$$</p>
<blockquote>
<p>However, the performance gains from these factor are not clear, due to the absence of ablations experiments. It looks like the &ldquo;Time-Travel&rdquo; (a kind of redundant computing) helped a lot.</p>
</blockquote>
<figure class="image">
<img src="https://image-1300968464.cos.ap-shanghai.myqcloud.com/Obsidian/20231017212649.png" loading="lazy" width="300">
<figcaption>
Time-Travel (source from paper)</figcaption>
</figure>

<h1 id="references" class="icon-inline" id="references">References<a class="icon-link" href="#references" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg></a></h1>
<ul>
<li>Yang Song and others, â€˜Solving Inverse Problems in Medical Imaging with Score-Based Generative Modelsâ€™  in <em>International Conference on Learning Representations</em>, 2022.</li>
<li>Hyungjin Chung and Jong Chul Ye, â€˜Score-Based Diffusion Models for Accelerated MRIâ€™, <em>Medical Image Analysis</em>, 80 (2022), 102479.</li>
<li>Johannes Schwab, Stephan Antholzer, and Markus Haltmeier, â€˜Deep Null Space Learning for Inverse Problems: Convergence Analysis and Ratesâ€™, <em>Inverse Problems</em>, 35.2 (2019), 025008.</li>
<li>Morteza Mardani and others, â€˜Deep Generative Adversarial Networks for Compressed Sensing Automates MRIâ€™ arXiv, 2017.</li>
<li>Yinhuai Wang, Jiwen Yu, and Jian Zhang, â€˜Zero-Shot Image Restoration Using Denoising Diffusion Null-Space Modelâ€™ in <em>International Conference on Learning Representations</em>, 2023.</li>
</ul>


</article>
</main>


<footer class="footer layout__footer mt--l">
<p><!--Creative Commons License-->This site is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC-BY-SA 4.0</a> licence.<!--/Creative Commons License--></p>

<p>Powered by <a href="https://gohugo.io/">Hugo</a> and the <a href="https://github.com/frjo/hugo-theme-zen">Zen theme</a>.</p>
</footer>

</div>
</body>
</html>
