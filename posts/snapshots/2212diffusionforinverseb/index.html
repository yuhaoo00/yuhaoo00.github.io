<!DOCTYPE html>
<html class="nojs" lang="en-GB" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Inverse Problem × Diffusion -- Part: B – Yu&#39;s MemoCapsule</title>
<meta name="view-transition" content="same-origin">
<meta name="description" content="DDRM -&amp;amp;gt; Bahjat Kawar, et al. NeurIPS, 2022. Illustration of DDRM (source from paper) Transformation via SVD Similar to SNIPS, DDRM consider the singular value …">
<meta name="created" content="2022-12-20T00:00:00+0000">
<meta name="modified" content="2022-12-20T00:00:00+0000">

<meta name="contact" content="TimberH2000@outlook.com">
<meta property="og:site_name" content="Yu&#39;s MemoCapsule">
<meta property="og:title" content="Inverse Problem × Diffusion -- Part: B">
<meta property="og:url" content="https://yuhaoo00.github.io/posts/snapshots/2212diffusionforinverseb/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://yuhaoo00.github.io/favicon-192.png">
<meta name="generator" content="Hugo 0.118.2">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#ffffff">


<link rel="canonical" href="https://yuhaoo00.github.io/posts/snapshots/2212diffusionforinverseb/">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">

<link rel="stylesheet" href="/css/mobile.928a90a2e5ceccad718844ea67aa6bba151ff555ab514fb103071cc7b60c2ff2.css" media="screen">
<link rel="stylesheet" href="/css/styles.4b0725243fe74b2ef00d4a9effe4e55d8555c705d333dd673a4232e7c4693eac.css">
<link rel="stylesheet" href="/css/print.31e2819287afc91406f2fd43d21a8ba4a0cdfc272e439c90db0c6e47efc7c346.css" media="print">

<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "WebPage",
    "headline": "Inverse Problem × Diffusion -- Part: B",
    "datePublished": "2022-12-20T00:00:00Z",
    "dateModified": "2022-12-20T00:00:00Z",
    "url" : "https://yuhaoo00.github.io/posts/snapshots/2212diffusionforinverseb/",
    "description": "DDRM -\u0026amp;gt; Bahjat Kawar, et al. NeurIPS, 2022. Illustration of DDRM (source from paper) Transformation via SVD Similar to SNIPS, DDRM consider the singular value …",
    "keywords": ["Diffusion","ScoreModel","ImageGeneration","InverseProblem","ControlledGeneration"],
    "image" : "https://yuhaoo00.github.io/favicon-192.png",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://yuhaoo00.github.io"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Yu's MemoCapsule",
      "logo" : {
        "@type": "ImageObject",
        "url": "https://yuhaoo00.github.io/favicon-192.png"
      },
      "url": "https://yuhaoo00.github.io"
    }
  }
</script>

<script src="/js/script-early.214cc4b0248ef64425811a906c0c6a3702edffba5dbc127128e9ff989c74c137.js"></script>

<script defer src="/js/mobile.2ee7f57bec29e942a94fc13cd4cf128b0b8daf996652b9725d7e9bf960496721.js"></script>
<script defer src="/js/script.1688e04483adf683d47143ac70e770c7b5e4b75213641f33b46d9b84cb3e91ca.js"></script>

<link rel="stylesheet" href="/katex/katex.min.css">
<script defer src="/katex/katex.min.js"></script>
<script defer src="/katex/contrib/auto-render.min.js"></script>
<script defer src="/js/math.f08366f847be855a2a8edced48e6cbaca080c199dfc2efd172b4788a2f58d85e.js"></script>



</head>

<body class="single-page">
<div class="page layout__page">
<header class="header layout__header">
<a href="/" title="Home" rel="home" class="header__logo">
<img src="/images/logo.png" width="40" height="40" alt="Home" class="header__logo-image">
</a>
<h1 class="header__site-name">
<a href="/" title="Home" class="header__site-link" rel="home"><span>Yu&#39;s MemoCapsule</span></a>
</h1>
<div class="region header__region">
</div>
<div class="mobile-nav" dir="ltr">
  <div class="mobile-nav__cover"></div>
  <button class="mobile-nav__toggle button--outline" aria-expanded="false" aria-controls="sheet">
    Menu
    <svg class="mobile-nav__hamburger" viewBox="0 0 100 100" focusable="false" aria-hidden="true">
      <rect width="80" height="12" x="10" y="20" rx="5"></rect>
      <rect width="80" height="12" x="10" y="45" rx="5"></rect>
      <rect width="80" height="12" x="10" y="70" rx="5"></rect>
    </svg>
  </button>
  <div class="mobile-nav__sheet link-inverted link-nav" id="sheet" aria-hidden="true">
    <div class="mobile-nav__region"></div>
    <nav class="mobile-nav__main-menu" aria-label="Main menu">
    <ul class="mobile-nav__navbar">
    <li><a href="/">Home</a></li>
    <li><a href="/contact/">Contact</a></li>
    <li><a href="/search/">Search</a></li>
    <li><a href="/posts/" aria-current="page">Posts</a></li>
    </ul>
    </nav>
  </div>
</div>
</header>

<nav class="main-menu layout__navigation" aria-label="Main menu">
<ul class="navbar">
<li><a href="/">Home</a></li>
<li><a href="/contact/">Contact</a></li>
<li><a href="/search/">Search</a></li>
<li><a href="/posts/" aria-current="page">Posts</a></li>
</ul>
</nav>
<main class="main layout__main">
<article class="single-view single-view--posts">
<header>
<h1 class="title mb--xxs">Inverse Problem × Diffusion -- Part: B</h1>
<div class="submitted meta">
<time class="created-date" datetime="2022-12-20T00:00:00Z">20 December, 2022</time>

</div>
<div class="tags meta">
Tags:
<ul>
<li><a href="https://yuhaoo00.github.io/tags/diffusion/">Diffusion</a></li>
<li><a href="https://yuhaoo00.github.io/tags/scoremodel/">ScoreModel</a></li>
<li><a href="https://yuhaoo00.github.io/tags/imagegeneration/">ImageGeneration</a></li>
<li><a href="https://yuhaoo00.github.io/tags/inverseproblem/">InverseProblem</a></li>
<li><a href="https://yuhaoo00.github.io/tags/controlledgeneration/">ControlledGeneration</a></li>
</ul>
</div>
</header>

<h2 id="ddrm" class="icon-inline" id="ddrm">DDRM<a class="icon-link" href="#ddrm" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg></a></h2>
<p><a href="http://arxiv.org/abs/2201.11793">-&gt; Bahjat Kawar, et al. NeurIPS, 2022.</a>
<figure class="image">
<img src="https://image-1300968464.cos.ap-shanghai.myqcloud.com/Obsidian/20231018160625.png" loading="lazy">
<figcaption>
Illustration of DDRM (source from paper)</figcaption>
</figure>
</p>
<h3 id="transformation-via-svd" class="icon-inline" id="transformation-via-svd">Transformation via SVD<a class="icon-link" href="#transformation-via-svd" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg></a></h3>
<p>Similar to <a href="https://proceedings.neurips.cc/paper_files/paper/2021/hash/b5c01503041b70d41d80e3dbe31bbd8c-Abstract.html">SNIPS</a>, DDRM consider the singular value decomposition (SVD) of the sampling matrix $H$ as follows:</p>
<p>$$
\begin{aligned}
y&amp;=Hx+z\
y&amp;=U\Sigma V^\top x+z\
\Sigma^{†} U^{\top}y&amp;=V^\top x+\Sigma^{†} U^{\top}z\
\bar{y}&amp;=\bar{x}+\bar{z}\
\end{aligned}
$$</p>
<p>Since $U$ is orthogonal matrix, we have $p(U^\top z) = p(z) = \mathcal{N}(0,\sigma^2_y I)$, resulting $\bar{z}^{(i)}=(\Sigma^{†} U^{\top}z)^{(i)} \sim \mathcal{N}(0, \frac{\sigma^2_y}{s_i^2}I)$. So after these, we transform $x$ and $y$ into the same field (<strong>spectral space</strong>), and these two only differ by the noise $\bar{z}$, which can be drawn as follows:</p>
<p>$$
q(\bar{y}^{(i)}|x_0)=\mathcal{N}(\bar{x}_0^{(i)},\sigma_y^2/s_i^2 )
$$</p>
<blockquote>
<p>DDRM might be unable to cope with the wild scene, cause the variance $\sigma_y$ is often unknown.</p>
</blockquote>
<h3 id="conditional-diffusion--generation" class="icon-inline" id="conditional-diffusion--generation">Conditional Diffusion &amp; Generation<a class="icon-link" href="#conditional-diffusion--generation" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg></a></h3>
<p>The desired conditional diffusion process should (a) be a tractable Gaussian distribution, (b) employ the known $y$ to construct noisy samples as possible and (c) ensure the original marginal:</p>
<p>$$
\begin{aligned}
q(x_t|x_0) = q(\bar{x}_t|x_0, y)\cdot q(\bar{y}|x_0)=\mathcal{N}(\bar{x}_0,\sigma_t^2I) \
\end{aligned}
$$</p>
<p>We note that $q(\bar{y}^{(i)}|x_0)=\mathcal{N}(\bar{x}_0^{(i)},\sigma_y^2/s_i^2 )$, so these conditional processes can be defined as follows:
<img src="https://image-1300968464.cos.ap-shanghai.myqcloud.com/Obsidian/20231018141254.png" alt="image.png">
From the perspective of DDIM, we can deduce the corresponding generative process via replacing $x_0$ with &ldquo;the predicted version&rdquo; as follows:
<img src="https://image-1300968464.cos.ap-shanghai.myqcloud.com/Obsidian/20231018153006.png" alt="image.png">
Intuitively, this construction considers different cases for each index of the spectral space. (i) If the corresponding singular value $s_i=0$, then $y$ does not directly provide any information to that index, and the update is similar to regular unconditional generation. (ii) If $s_i &gt;0$, then the updates consider the information provided by $y$, which further depends on whether the measurements’ noise level $\sigma_y/s_i$ in the spectral space is larger than the noise level in the diffusion model or not.</p>
<p>In the resulting generation, the initial sample carries a few information from $\bar{y}$, then is updated eventually by the guidance of $p_\theta(\bar{x}_t|x_t+1,y)$,  and is recovered to $x_0$ exactly by left multiplying $V$.</p>
<blockquote>
<p>Although this conditional process results in a more complex ELBO objective for training, the authors proof that an optimal solution to DDPM / DDIM can also be an optimal solution to a DDRM problem, under some similar assumptions as in DDIM. So <strong>DDRM can be training-free</strong>.</p>
</blockquote>
<h3 id="one-more-thing" class="icon-inline" id="one-more-thing">One more thing<a class="icon-link" href="#one-more-thing" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg></a></h3>
<p>DDRM is applied in super-resolution, deblurring, inpainting, and colorization. There&rsquo;re no much difference of the value space between original $x$ and degraded $y$ in these task. These data are almost all in the perceptible pixel space. So does SVD really work as claimed? This paper lacks relevant ablation study for that. Maybe we should introduce this into more tasks, such as compressive sensing, and see what will happen.</p>
<h1 id="references" class="icon-inline" id="references">References<a class="icon-link" href="#references" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg></a></h1>
<ul>
<li>Kawar, Bahjat, Gregory Vaksman, and Michael Elad. &ldquo;SNIPS: Solving noisy inverse problems stochastically.&rdquo; <em>Advances in Neural Information Processing Systems</em> 34 (2021): 21757-21769.</li>
<li>Kawar, Bahjat, et al. &ldquo;Denoising diffusion restoration models.&rdquo; <em>Advances in Neural Information Processing Systems</em> 35 (2022): 23593-23606.</li>
</ul>


</article>
</main>


<footer class="footer layout__footer mt--l">
<p><!--Creative Commons License-->This site is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC-BY-SA 4.0</a> licence.<!--/Creative Commons License--></p>


</footer>

</div>
</body>
</html>
